<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/p2p/p2p_4.css" th:href="@{/css/p2p/p2p_4.css}">
    <title>Í∞úÏù∏Í∞Ñ Ï†ÑÎ†•Í±∞Îûò Í≤åÏãúÍ∏Ä Î™©Î°ù</title>
    <style>
        .board-list-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .board-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .board-list-header h2 {
            font-size: 28px;
            font-weight: bold;
        }

        .write-btn {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .write-btn:hover {
            background-color: #0056b3;
        }

        .board-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s ease;
        }

        .board-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .board-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .board-item-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .board-item-title:hover {
            color: #007bff;
            text-decoration: underline;
        }

        .board-filter-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
        }

        .filter-buyer {
            background-color: #e7f3ff;
            color: #0066cc;
        }

        .filter-seller {
            background-color: #fff4e6;
            color: #ff9900;
        }

        .board-item-meta {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }

        .board-item-content {
            color: #555;
            margin-bottom: 10px;
            line-height: 1.5;
            max-height: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .board-item-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tag {
            display: inline-block;
            background-color: #f0f0f0;
            color: #333;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .board-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #f0f0f0;
            padding-top: 10px;
        }

        .board-item-address {
            font-size: 12px;
            color: #999;
        }

        .board-item-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background-color: white;
            color: #333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .action-btn:hover {
            background-color: #f5f5f5;
        }

        .action-btn.delete {
            color: #d9534f;
            border-color: #d9534f;
        }

        .action-btn.delete:hover {
            background-color: #fff5f5;
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 30px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
        }

        .pagination button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination button:hover:not(.active) {
            background-color: #f5f5f5;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .search-btn {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-btn:hover {
            background-color: #5a6268;
        }

        .filter-select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        .message {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
    <link rel="stylesheet" href="/css/p2p/board-list-modern.css" th:href="@{/css/p2p/board-list-modern.css}">
</head>
<body>
<div id="main-app" class="page-wrapper">
    <!-- Header -->
    <header class="Header_container__38zbn Header_sticky__3oYwh">
        <div class="Header_content__QB1FT">
            <div class="Header_left__2saU5">
                <button class="StyledComponent_container__1LgDP"
                        aria-label="Îí§Î°ú Í∞ÄÍ∏∞"
                        type="button"
                        th:onclick="'location.href=\'' + @{/ev/main} + '\';'">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" class="WithProps_icon__2zN1K" style="height: 24px; width: 24px;">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M16.076 2.576l.848.848L8.35 12l8.575 8.576-.848.848L6.65 12l9.425-9.424z" fill="#495057"></path>
                    </svg>
                </button>
            </div>

            <div class="Header_center__1CCBu" style="max-width: calc(-240px + 100vw);"></div>

            <div class="Header_right__2g4ES">
                <div class="StyledComponent_container__1LgDP" style="padding: 4px;">
                    <button class="CountryChangeButton_container__3mgYZ" type="button">
                        <img alt="KR" class="CountryChangeButton_flag__17556" src="https://flagcdn.com/w80/kr.jpg">
                    </button>
                </div>
                <a class="StyledComponent_container__1LgDP" th:href="@{/ev/main}">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" class="WithProps_icon__2zN1K" style="height: 24px; width: 24px;">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M11 2.4a8.6 8.6 0 105.642 15.09l3.934 3.934.848-.848-3.933-3.934A8.6 8.6 0 0011 2.4zM3.6 11a7.4 7.4 0 1114.8 0 7.4 7.4 0 01-14.8 0z" fill="#495057"></path>
                    </svg>
                </a>
                <a class="StyledComponent_container__1LgDP" th:href="@{/ev/main}" aria-label="ÌôàÏúºÎ°ú Í∞ÄÍ∏∞">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" class="WithProps_icon__2zN1K" style="height: 24px; width: 24px;">
                        <path d="M21.6 7.679l-9.6-6.4-9.6 6.4V21h1.2V8.321l8.4-5.6 8.4 5.6V21h1.2V7.679z" fill="#495057"></path>
                        <path d="M15.6 21v-8.6H8.4V21h1.2v-7.4h4.8V21h1.2z" fill="#495057"></path>
                    </svg>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="board-list-container">
        <div class="board-list-header">
            <h2>Í∞úÏù∏Í∞Ñ Ï†ÑÎ†•Í±∞Îûò Í≤åÏãúÌåê</h2>
            <button class="write-btn" onclick="location.href='/p2p/write';">‚úçÔ∏è Í∏Ä ÏûëÏÑ±</button>
        </div>

        <!-- Success/Error Messages -->
        <div th:if="${successMessage}" class="message success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="message error" th:text="${errorMessage}"></div>

        <!-- Search & Filter -->
        <div class="search-container">
            <form method="get" th:action="@{/p2p/list}" style="display: flex; width: 100%; gap: 10px;">
                <select name="filter" class="filter-select">
                    <option value="">Î™®Îì† ÌïÑÌÑ∞</option>
                    <option value="buyer" th:selected="${filter == 'buyer'}">Íµ¨Îß§Ïûê</option>
                    <option value="seller" th:selected="${filter == 'seller'}">ÌåêÎß§Ïûê</option>
                </select>
                <input type="text" name="keyword" class="search-input" placeholder="Ï†úÎ™©, ÎÇ¥Ïö©ÏúºÎ°ú Í≤ÄÏÉâ..." th:value="${keyword}">
                <button type="submit" class="search-btn">üîç Í≤ÄÏÉâ</button>
            </form>
        </div>

        <!-- Board List -->
        <div th:if="${boards != null && boards.size() > 0}">
            <div th:each="board : ${boards}" class="board-item">
                <div th:if="${board.representativeFilePath != null and board.representativeFileName != null}" style="margin-bottom: 12px;">
                    <img th:src="@{/api/files/display(filePath=${board.representativeFilePath}, fileName=${board.representativeFileName})}"
                         alt="ÎåÄÌëúÏù¥ÎØ∏ÏßÄ"
                         style="width: 100%; max-height: 220px; object-fit: cover; border-radius: 10px; border: 1px solid #dbe5ef;">
                </div>
                <div class="board-item-header">
                    <div>
                        <div class="board-item-title" th:onclick="'location.href=\'' + @{/p2p/detail/} + ${board.id} + '\';'" style="cursor: pointer;">
                            <span th:if="${board.boardFilter != null and board.boardFilter.name() == 'BUY'}" class="board-filter-badge filter-buyer">Íµ¨Îß§</span>
                            <span th:if="${board.boardFilter != null and board.boardFilter.name() == 'SELL'}" class="board-filter-badge filter-seller">ÌåêÎß§</span>
                            <span th:text="${board.title}"></span>
                        </div>
                    </div>
                </div>

                <div class="board-item-meta">
                    <span th:text="'ÏûëÏÑ±Ïûê: ' + ${board.boardMemberId}"></span>
                    <span th:text="'ÏûëÏÑ±Ïùº: ' + ${board.createdDate}"></span>
                </div>

                <div class="board-item-content" th:text="${board.summary != null ? board.summary : board.content}"></div>

                <!-- Tags -->
                <div class="board-item-tags" th:if="${board.boardTags != null && board.boardTags.size() > 0}">
                    <span class="tag" th:each="tag : ${board.boardTags}" th:text="'#' + ${tag.tagName}"></span>
                </div>

                <div class="board-item-footer">
                    <div class="board-item-address">üìç Í±∞Îûò ÏßÄÏó≠ Ï†ïÎ≥¥ ÏóÜÏùå</div>
                    <div class="board-item-actions">
                        <button class="action-btn" th:onclick="'location.href=\'' + @{/p2p/update} + '?id=' + ${board.id} + '\';'">ÏàòÏ†ï</button>
                        <button class="action-btn delete" th:onclick="'deleteBoard(' + ${board.id} + ');'">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button th:if="${currentPage > 1}" onclick="location.href='/p2p/list?page=1'" type="button">¬´</button>
                <button th:if="${currentPage > 1}" th:onclick="'location.href=\'/p2p/list?page=' + ${currentPage - 1} + '\';'" type="button">‚Äπ</button>

                <span th:if="${criteria != null and criteria.realEnd > 0}">
                    <button th:each="i : ${#numbers.sequence(criteria.startPage, criteria.endPage)}"
                            th:text="${i}"
                            th:class="${currentPage == i} ? 'active' : ''"
                            th:onclick="'location.href=\'/p2p/list?page=' + ${i} + '\';'"></button>
                </span>

                <button th:if="${criteria.hasMore}" th:onclick="'location.href=\'/p2p/list?page=' + ${currentPage + 1} + '\';'" type="button">‚Ä∫</button>
                <button th:if="${criteria.hasMore}" th:onclick="'location.href=\'/p2p/list?page=' + ${criteria.realEnd} + '\';'" type="button">¬ª</button>
            </div>
        </div>

        <!-- No Data -->
        <div th:if="${boards == null || boards.isEmpty()}" class="no-data">
            <p>ÏûëÏÑ±Îêú Í≤åÏãúÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</p>
            <p style="font-size: 14px; margin-top: 10px;">
                <a href="/p2p/write" style="color: #007bff; text-decoration: underline;">Ï≤´ Î≤àÏß∏ Í∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!</a>
            </p>
        </div>
    </main>
</div>

<script>
    function deleteBoard(boardId) {
        if (confirm('Ï†ïÎßêÎ°ú Ïù¥ Í≤åÏãúÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
            location.href = '/p2p/delete?id=' + boardId;
        }
    }

    // ÏûêÎèô Î©îÏãúÏßÄ Îã´Í∏∞ (5Ï¥à ÌõÑ)
    document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('.message');
        messages.forEach(msg => {
            setTimeout(() => {
                msg.style.display = 'none';
            }, 5000);
        });
    });
</script>
</body>
</html>
